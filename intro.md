## SERVICE MESH

![image](https://github.com/pavankumar0077/istio-guide/assets/40380941/60582368-cb0f-4e5a-93c6-a26380ec0845)

### WHAT IS SERVICE MESH IN KUBERNETES CLUSTER
- SERVICE MESH MANAGES THE TRAFFIC MANAGEMENT IN KUBERNETES CLUSTER SPECIALLY EAST WEST TRAFFIC MANAGEMENT OF K8S CLUSTER.
- TRAFFIC BETWEEN KUBERENTES SERVICES AND CLUSTERS
- 

### EX :
- A E-com application is deployed in kubernetes cluster with 4 microservices (login, catalog, payment, notification)
- LOGIN --> CATALOG --> PAYMENTS --> NOTIFICATIONS
- If this e-com application has to expose to the customers or to the users outside the kubernetes cluster -- A IGRESS IS CREATED OR SERVICE TYPE OF NODEPORT OR LOAD BALANCER TYPE
- user must access the LOGIN microservice outside the KUBERNETES CLUSTER. Only then the e-com application will be able to LOGIN from the user or customers.
- IN THIS WE NEED TO CONTROL THE TRAFFIC -- ONE is traffic comming from the ingress -- that is from the users -- outside the kubernetes cluster ==== THIS IS CALLED NORTH SOUTH GRAPH
- OTHER one is LOGIN TALKING TO THE CATALOG -- AND FLOW GOES --> PAYMENTS --> NOTIFICATIONS, THIS DOESN'T REQUIRED ANY INGRESS OR EGRESS TRAFFIC ==== THIS IS CALLED AS EAST WEST TRAFFIC


### WHY SERVICE MESH
- AS SEEN ABOVE EXAMPLE SERVICE TO SERVICE COMMUNICATION IS POSSIBLE
- BUT ISTIO ENHANCES OR ADDS ON CAPABILITES TO YOUR SERVICE TO SERVICE COMMUNICATION SUCH AS **MUTUAL TLS**
- ISTIO ADDS THE MUTUAL TLS SERVICE TO SERVICE COMMUNICATION, IT ALSO ADDS OTHER CAPABILITES SUCH AS ADVANCED DEPLOY **CANARY/AB/BLUE-GREEN**
- ISTIO COMES WITH OBSERVABILITY IT COMES WITH **KIALI**, IT KEEPS THE TRACK OF YOUR SERVICE TO SERVICE COMMUNICATION 

### WHAT IS MUTUAL TLS
- IF WE INSTALL ISTIO AND ALLOW ISTIO TO A PARTICULAR NAME SPACE THEN ISTIO SAYS IT WILL SECURE SERVICE TO SERVICE COMMUNICATION
- BYDEFAULT THESE SERVICES ARE TALING WITHOUT ANY TLS WITHOUT ANY SECURIY MEASURES
- IF WE NEED INSTALL IT WILL ADD MUTUAL TLS, SO ALL THE 4 MICROSERVICES WILL HAVE TLS CERTIFICATE WHICH WLL BE GIVEN BY CERTICATE AUTHORITY (CA) OF ISTIO
- WHEN LOGIN SERVICE WANTS TO COMMUNICATE WITH CATALOG IT WILL DISPLAY THE CERTIFICATE BOTH DISPLAYS THEIR CERTIFICATES TO EACH OTHER AND ONLY WHEN BOTH OF THEM TRUST EACH OTHER A COMMUNICATION IS ESTABLISHED.
- IN TRADITIONAL TLS APPROACH USUALLY CLIENT IS THE ONE THAT DISPLAYS CERTIFICATE TO THE SERVER AND IF THER SERVER ACKNOWLEGES THEN A TRUST IS ESTABLISTED AND COMMUNICATION IS ESTABLISHED.
- ISTIO IS ADVANCE LEVEL OF TLS
- ISTIO HAS ADVANCE DEPLOYMENT STRATEGIES LIKE CANARY, AB, BLUE - GREEN DEPLOYMENTS IN A VERY EASY WAY

### CANARY DEPLOYMENT
- Catalog C is talking to Payments P -- Assume it as Version v1
- we want to introduce advance future for the payments called P2 as Version V2
- we have tested in testing, dev and other envornments but we are not confident to PUT IN THE PROD for all the customers
- So we can use deplooyment strtegies like Canary where initially you can request your catalog service to ONLY SEND 10% OF TRAFFIC to the new VERSION that is V2, and REST 90% TO V1

## HOW ISTIO WORKS
- ISTIO ADDS NEW CONTAINER IN EACH AND EVERY POD, THAT SITS NEXT TO THE ACTUAL CONTAINER
- SIDE-CAR CONTAINER HAS A ENVOY PROXY APPLICATION IT IS A PROXY SERVER, IT HANDLES THE TRAFFIC MANAGEMENT OF KUBERNETES CLUSTER
- ANY REQUEST IN AND OUTSIDE WILL COME AND GO FROM THE SIDE-CAR CONTAINER
- THIS SIDE-CAR CONTAINER IS INSTALLED IN EACH AND EVERY POD OF YOUR KUBERNETS CLUSTER.

### Example :
- We have Catalog C, Payment P, In General without ISTIO what catalog does with requests a API CALL TO PAYMENTS

- WITHOUT SERVICE MESH
- IT uses SERVICE URL OF CATALOG APP, ( iT WILL GET IT FROM CONFIG MAP OR  CATALOG GETS THE SERVICE URL OF PAYMENT FROM THE COMMAND ARGUMENT ANYWAYS IT INITIATE A API REQUEST AND PAYMENT WILL SEND THE RESPONSE.

- WITH SERVICE MESH
- CATALOG TRIES TO INITIATE A API CALL TO THE PAYMENTS, THE REQUEST WILL BE TAKEN BY THE SIDE-CAR CONTAINER THE API CALL IS INTERCEPTED BY THE SIDECAR CONTAINER IT GOES TO THE SIDE-CAR CONTAINER AND FROM THERE IT WILL GO TO THE PAYMENTS AGAIN THE SIDE-CAR CONTAINER IN THE PAYMENTS WILL INTERCEPT THE REQUEST AND THEN IT GOES TO THE PAYMENTS
- BOTH INWARD TRAFFIC AND OUTWARD TRAFFIC IS INTERCEPTED BY THE SIDECAR CONTAINERS.

### ISTIOD
-- IT IS PRIMARY COMPONET OF THE ISTIO IT RECEIVERS ALL THES INFORMATION AND IT KEEPS THE TRACK OF ALL THE SERVICE METRICES WHICH WILL 
